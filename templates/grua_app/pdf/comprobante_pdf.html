<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Comprobante {{ solicitud.numero_orden }} - Grúa Style</title>
    <style>
        @page {
            size: A4;
            margin: 2cm;
            @top-center {
                content: "Grúa Style - Comprobante de Servicio";
                font-family: Arial, sans-serif;
                font-size: 12px;
                color: #666;
            }
            @bottom-center {
                content: "Página " counter(page) " de " counter(pages);
                font-family: Arial, sans-serif;
                font-size: 10px;
                color: #666;
            }
        }

        body {
            font-family: Arial, sans-serif;
            font-size: 12px;
            line-height: 1.4;
            color: #333;
            margin: 0;
            padding: 0;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 3px solid #00D563;
            padding-bottom: 20px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 20px;
            border-radius: 10px;
        }

        .logo {
            font-size: 28px;
            font-weight: bold;
            color: #00D563;
            margin-bottom: 5px;
        }

        .subtitle {
            color: #666;
            font-size: 14px;
        }

        .comprobante-title {
            background: #00D563;
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: center;
        }

        .comprobante-number {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .section {
            margin-bottom: 25px;
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            border-left: 5px solid #00D563;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .section-title {
            font-size: 16px;
            font-weight: bold;
            color: #00D563;
            margin-bottom: 15px;
            border-bottom: 2px solid #00D563;
            padding-bottom: 8px;
            display: flex;
            align-items: center;
        }

        .section-icon {
            margin-right: 10px;
            font-size: 18px;
        }

        .info-grid {
            display: table;
            width: 100%;
        }

        .info-row {
            display: table-row;
        }

        .info-label {
            display: table-cell;
            font-weight: bold;
            color: #555;
            padding: 10px 20px 10px 0;
            width: 35%;
            vertical-align: top;
            border-bottom: 1px solid #eee;
        }

        .info-value {
            display: table-cell;
            padding: 10px 0;
            color: #333;
            vertical-align: top;
            border-bottom: 1px solid #eee;
        }

        .status {
            display: inline-block;
            padding: 8px 20px;
            border-radius: 25px;
            font-weight: bold;
            text-transform: uppercase;
            font-size: 12px;
            letter-spacing: 1px;
        }

        .status-confirmada {
            background: #d4edda;
            color: #155724;
            border: 2px solid #00D563;
        }

        .status-completada {
            background: #cce5ff;
            color: #004085;
            border: 2px solid #007bff;
        }

        .status-pendiente_pago {
            background: #fff3cd;
            color: #856404;
            border: 2px solid #ffc107;
        }

        .payment-section {
            background: linear-gradient(135deg, #e8f5e8 0%, #d4edda 100%);
            border: 3px solid #00D563;
            border-radius: 15px;
            padding: 25px;
            margin: 30px 0;
        }

        .payment-title {
            font-size: 20px;
            font-weight: bold;
            color: #00D563;
            margin-bottom: 20px;
            text-align: center;
            text-transform: uppercase;
        }

        .cost-breakdown {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .cost-item {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid #eee;
            font-size: 14px;
        }

        .cost-item:last-child {
            border-bottom: none;
            font-weight: bold;
            font-size: 18px;
            color: #00D563;
            border-top: 3px solid #00D563;
            padding-top: 15px;
            margin-top: 15px;
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
        }

        .paid-stamp {
            text-align: center;
            margin: 30px 0;
            position: relative;
        }

        .stamp {
            display: inline-block;
            padding: 20px 40px;
            border: 5px solid #00D563;
            border-radius: 15px;
            transform: rotate(-15deg);
            font-size: 24px;
            font-weight: bold;
            color: #00D563;
            background: rgba(0, 213, 99, 0.1);
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .payment-method {
            background: #e7f3ff;
            border: 2px solid #74b9ff;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }

        .payment-method-title {
            font-weight: bold;
            color: #004085;
            margin-bottom: 10px;
            font-size: 16px;
        }

        .footer {
            margin-top: 50px;
            text-align: center;
            color: #666;
            font-size: 11px;
            border-top: 2px solid #ddd;
            padding-top: 20px;
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
        }

        .important-note {
            background: #fff3cd;
            border: 2px solid #ffeaa7;
            border-radius: 10px;
            padding: 20px;
            margin: 25px 0;
            color: #856404;
        }

        .contact-emergency {
            background: #ffebee;
            border: 2px solid #ff5722;
            border-radius: 10px;
            padding: 20px;
            margin: 25px 0;
            color: #c62828;
        }

        .qr-section {
            text-align: center;
            background: #f0f0f0;
            border-radius: 10px;
            padding: 20px;
            margin: 25px 0;
            border: 2px dashed #999;
        }

        .validity-section {
            background: #e3f2fd;
            border: 2px solid #2196f3;
            border-radius: 10px;
            padding: 15px;
            margin: 20px 0;
            color: #1565c0;
            text-align: center;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="header">
        <div class="logo">🚛 GRÚA STYLE</div>
        <div class="subtitle">Servicio de Grúa Profesional 24/7</div>
    </div>

    <!-- Título del Comprobante -->
    <div class="comprobante-title">
        <div class="comprobante-number">COMPROBANTE DE SERVICIO</div>
        <div>N° {{ solicitud.numero_orden }}</div>
    </div>

    <!-- Información del Cliente -->
    <div class="section">
        <div class="section-title">
            <span class="section-icon">👤</span>
            INFORMACIÓN DEL CLIENTE
        </div>
        <div class="info-grid">
            <div class="info-row">
                <div class="info-label">Cliente:</div>
                <div class="info-value">
                    {% if usuario.first_name and usuario.last_name %}
                        {{ usuario.first_name }} {{ usuario.last_name }}
                    {% else %}
                        {{ usuario.username }}
                    {% endif %}
                </div>
            </div>
            <div class="info-row">
                <div class="info-label">Email:</div>
                <div class="info-value">{{ usuario.email }}</div>
            </div>
            {% if usuario.cliente.telefono %}
            <div class="info-row">
                <div class="info-label">Teléfono:</div>
                <div class="info-value">{{ usuario.cliente.telefono }}</div>
            </div>
            {% endif %}
            {% if usuario.cliente.rut %}
            <div class="info-row">
                <div class="info-label">RUT:</div>
                <div class="info-value">{{ usuario.cliente.rut }}</div>
            </div>
            {% endif %}
        </div>
    </div>

    <!-- Detalles del Servicio -->
    <div class="section">
        <div class="section-title">
            <span class="section-icon">🚛</span>
            DETALLES DEL SERVICIO
        </div>
        <div class="info-grid">
            <div class="info-row">
                <div class="info-label">Fecha de Solicitud:</div>
                <div class="info-value">{{ solicitud.fecha_solicitud|date:"d/m/Y H:i" }}</div>
            </div>
            <div class="info-row">
                <div class="info-label">Fecha del Servicio:</div>
                <div class="info-value">{{ solicitud.fecha_servicio|date:"d/m/Y H:i" }}</div>
            </div>
            <div class="info-row">
                <div class="info-label">Estado del Servicio:</div>
                <div class="info-value">
                    <span class="status status-{{ solicitud.estado }}">
                        {{ solicitud.get_estado_display }}
                    </span>
                </div>
            </div>
            <div class="info-row">
                <div class="info-label">Origen:</div>
                <div class="info-value">{{ solicitud.direccion_origen }}</div>
            </div>
            <div class="info-row">
                <div class="info-label">Destino:</div>
                <div class="info-value">{{ solicitud.direccion_destino }}</div>
            </div>
            {% if solicitud.distancia_km %}
            <div class="info-row">
                <div class="info-label">Distancia Recorrida:</div>
                <div class="info-value">{{ solicitud.distancia_km }} kilómetros</div>
            </div>
            {% endif %}
            <div class="info-row">
                <div class="info-label">Descripción del Problema:</div>
                <div class="info-value">{{ solicitud.descripcion_problema }}</div>
            </div>
        </div>
    </div>

    <!-- Información de Pago -->
    <div class="payment-section">
        <div class="payment-title">💰 Información de Pago</div>
        <div class="cost-breakdown">
            <div class="cost-item">
                <span><strong>Tarifa Base del Servicio:</strong></span>
                <span><strong>${{ tarifa_base|floatformat:0 }}</strong></span>
            </div>
            {% if solicitud.distancia_km %}
            <div class="cost-item">
                <span>Distancia ({{ solicitud.distancia_km }} km × ${{ tarifa_por_km|floatformat:0 }}/km):</span>
                <span>${{ costo_km|floatformat:0 }}</span>
            </div>
            {% endif %}
            <div class="cost-item">
                <span>Tarifa Mínima Garantizada:</span>
                <span>${{ tarifa_minima|floatformat:0 }}</span>
            </div>
            <div class="cost-item">
                <span>🏆 TOTAL FINAL:</span>
                <span>${{ total|floatformat:0 }}</span>
            </div>
        </div>
    </div>

    <!-- Método de Pago -->
    {% if solicitud.metodo_pago %}
    <div class="payment-method">
        <div class="payment-method-title">💳 Método de Pago Utilizado</div>
        <strong>{{ solicitud.get_metodo_pago_display }}</strong>
        {% if solicitud.webpay_authorization_code %}
        <br><small>Código de Autorización: {{ solicitud.webpay_authorization_code }}</small>
        {% endif %}
    </div>
    {% endif %}

    <!-- Sello de Pagado (si aplica) -->
    {% if solicitud.pagado %}
    <div class="paid-stamp">
        <div class="stamp">✅ PAGADO</div>
    </div>
    {% endif %}

    <!-- Validez del Comprobante -->
    <div class="validity-section">
        <strong>📋 VALIDEZ DEL COMPROBANTE</strong><br>
        Este comprobante es válido como prueba de servicio prestado.<br>
        Documento generado el {{ fecha_generacion|date:"d/m/Y" }} a las {{ fecha_generacion|time:"H:i" }}
    </div>

    <!-- Nota Importante -->
    <div class="important-note">
        <strong>📌 TÉRMINOS Y CONDICIONES:</strong><br>
        • Este comprobante certifica la prestación del servicio de grúa.<br>
        • Conserve este documento para futuras referencias.<br>
        • En caso de reclamos, presente este comprobante junto con su solicitud.<br>
        • El servicio incluye seguro de responsabilidad civil durante el traslado.<br>
        • Garantía de calidad en todos nuestros servicios.
    </div>

    <!-- Contacto de Emergencia -->
    <div class="contact-emergency">
        <strong>🚨 SERVICIO AL CLIENTE</strong><br>
        <strong>Teléfono:</strong> +56 9 1234 5678<br>
        <strong>Email:</strong> reclamos@gruastyle.com<br>
        <strong>Horario de Atención:</strong> 24 horas, 7 días a la semana
    </div>

    <!-- Código QR (Placeholder) -->
    <div class="qr-section">
        <strong>📱 VERIFICACIÓN DIGITAL</strong><br>
        Para verificar la autenticidad de este comprobante,<br>
        visite: www.gruastyle.com/verificar<br>
        <strong>Código:</strong> {{ solicitud.numero_orden }}
    </div>

    <!-- Footer -->
    <div class="footer">
        <p><strong>🚛 GRÚA STYLE - SERVICIO DE GRÚA PROFESIONAL</strong></p>
        <p><strong>RUT:</strong> 12.345.678-9 | <strong>Dirección:</strong> Av. Principal 123, Santiago, Chile</p>
        <p><strong>Web:</strong> www.gruastyle.com | <strong>Email:</strong> contacto@gruastyle.com</p>
        <p><strong>Teléfono:</strong> +56 9 1234 5678 | <strong>Emergencias:</strong> 24/7</p>
        <hr>
        <p style="margin-top: 15px; font-size: 10px;">
            <strong>COMPROBANTE OFICIAL - GRÚA STYLE</strong><br>
            Documento generado automáticamente el {{ fecha_generacion|date:"d/m/Y" }} a las {{ fecha_generacion|time:"H:i" }}<br>
            Este comprobante tiene validez legal como constancia de servicio prestado.<br>
            Para consultas o reclamos, contacte a nuestro servicio al cliente.
        </p>
    </div>
</body>
</html>